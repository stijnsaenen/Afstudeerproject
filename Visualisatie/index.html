<!DOCTYPE html>
<meta charset="utf-8">
<link rel="icon" type="image/png" href="logohead.png">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<script src="https://d3js.org/d3.v2.min.js?2.9.3"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<style>
    .link {
        stroke: #aaa;
    }

    .node text {
        stroke: #333;
        cursor: pointer;
    }

    .node circle {
        stroke: #555;
        stroke-width: 1px;
        fill: beige;
        cursor: pointer;
    }

    body,
    h1,
    h2,
    h3,
    h4,
    h5 {
        font-family: "Raleway", sans-serif
    }

    #area1 {
        float: left;
        clear: none;
        padding-left: 10%;
        padding-right: 10px;

    }

    #area2 {
        float: left;
        clear: none;
    }

    #area2 svg {
        border-style: solid;
        border-color: black;
        border-width: 1px;
    }

    #area3 {
        float: left;
        clear: none;
    }
</style>

<body>
    <header class="w3-container w3-center w3-padding-32">
        <img src="fototop.png">
        <form style="float:right;display:inline-block;line-height:52px;padding-right:168px;padding-top:40px">
            <input type="text" name="searchbar" placeholder="search.." size="99">
        </form>
    </header>

    <div id="area1"></div>

    <div id="area2"></div>

    <div id="area3"></div>

    <script>
        var width = window.innerWidth,
            height = 800

        // Network window

        var svg = d3.select("#area1").append("svg")
            .attr("width", (3 / 7) * width)
            .attr("height", height * 0.8);


        var borderPath = svg.append("rect")
            .attr("x", 0)
            .attr("y", 0)
            .attr("width", (3 / 7) * width)
            .attr("height", height * 0.8)
            .style("stroke", "black")
            .style("fill", "white")
            .style("stroke-width", 1)

        var force = d3.layout.force()
            .gravity(.05)
            .distance(100)
            .charge(-300)
            .size([(3 / 7) * width, height * 0.8]);

        d3.json("graph.json", function(json) {
            force
                .nodes(json.nodes)
                .links(json.links)
                .start();

            var link = svg.selectAll(".link")
                .data(json.links)
                .enter().append("line")
                .attr("class", "link")
                .style("stroke-width", function(d) {
                    return Math.sqrt(d.weight);
                });

            var node = svg.selectAll(".node")
                .data(json.nodes)
                .enter().append("g")
                .attr("class", "node")
                .on("click", smaller)
                .call(force.drag);

            node.append("circle")
                .attr("r", "17");

            node.append("text")
                .attr("dx", 0)
                .attr("dy", ".35em")
                .attr("y", -25)
                .style("text-anchor", "middle")
                .text(function(d) {
                    return d.name
                });

            var tip;
            var xSpacing = 25;
            var ySpacing = 40;

            function sendInfo(d) {
                showInfo(d);
            }

            node.on("mouseover", function(d) {
                sendInfo(d);
            });


            force.on("tick", function() {
                link.attr("x1", function(d) {
                        return d.source.x;
                    })
                    .attr("y1", function(d) {
                        return d.source.y;
                    })
                    .attr("x2", function(d) {
                        return d.target.x;
                    })
                    .attr("y2", function(d) {
                        return d.target.y;
                    });

                node.attr("transform", function(d) {
                    return "translate(" + d.x + "," + d.y + ")";
                });
            });

        });

        function smaller() {
            d3.select(".test").remove();
            d3.select(".info").remove();
        }

        var infoArea;
        var contactInfo = d3.select('#area2').append("svg")
            .attr("width", (4 / 7) * width * 0.65)
            .attr("height", height * 0.55)

        function showInfo(d) {
            if (infoArea) infoArea.remove();

            infoArea = contactInfo.append("g")
                .attr('class', 'info')

            var rect = d3.select('.info').append("rect")
                .style("fill", "white")
                .style("stroke", "black")

            var text1 = d3.select('.info').append("text")
                .attr("dy", "1em")
                .attr("dx", 5)
                .attr("text-anchor", "start")
                .text("Contact name: " + d.name)

            var text2 = d3.select('.info').append("text")
                .attr("dy", "2em")
                .attr("dx", 5)
                .attr("text-anchor", "start")
                .text("Placeholder: " + "placeholder text")


            var infoBbox = d3.select('.info').node().getBBox()
        };


        var legendInfo = d3.select('#area3').append("svg")
            .attr("width", (4 / 7) * width * 0.8)
            .attr("height", height * 0.3)

        var legendArea = legendInfo.append("g")
            .attr('class', 'legend')

        var rect = d3.select('.legend').append("rect")
            .style("fill", "white")
            .style("stroke", "black")

        var text1 = d3.select('.legend').append("text")
            .attr("dy", "1em")
            .attr("dx", 5)
            .attr("text-anchor", "start")
            .text("Placeholder legende")

        var legendBox = d3.select('.legend').node().getBBox()
        rect.attr("x", legendBox.x - 5)
            .attr("y", legendBox.y)
            .attr("width", (4 / 7) * width * 0.65)
            .attr("height", height * 0.24)

        /*$.ajax({
            dataType: "json",
            url: 'http://localhost:5000/all',
            data: 'relations',
            success: function(data) {
                var items = [];
                $.each(data, function(key, val) {
                    items.push("<li id='" + key + "'>" + val + "</li>");
                });
                $("<ul/>", {
                    "class": "my-new-list",
                    html: items.join("")
                }).appendTo("body");
            }
        })*/
        /*
                var response = $.ajax({
                    method: 'GET',
                    url: 'http://localhost:5000/all',
                    dataType: 'json', //change the datatype to 'jsonp' works in most cases
                })
                console.log(response)*/
        /*$.getJSON("http://localhost:5000/all", function(data) {
            var items = [];
            $.each(data.relations, function(key, val) {
                items.push("<li>" + key + " " + val.RelationId + "</li>");
            });

            $("<ul/>", {
                "class": "my-new-list",
                html: items.join("")
            }).appendTo("body");
        });*/
        $.getJSON("http://localhost:5000/all", function(data) {
            data.relations.forEach(printValues)
            function printValues(value, key){
                console.log('RelationId: ' + value.RelationId + ' LeftContactId: ' + value.LeftContactId + ' RightContactId: ' + value.RightContactId + ' RelationTypeId: ' + value.RelationTypeId )
            }
        });
    </script>
</body>